FROM public.ecr.aws/docker/library/python:3.11
EXPOSE 80

ARG DEPLOYMENT_SECRET_ARN
ENV DEPLOYMENT_SECRET_ARN $DEPLOYMENT_SECRET_ARN

ARG AWS_REGION
ENV AWS_REGION $AWS_REGION

ARG ALERTS_TOPIC_ARN
ENV ALERTS_TOPIC_ARN $ALERTS_TOPIC_ARN

ARG RUNTIME_JSON
ENV RUNTIME_JSON $RUNTIME_JSON

ARG SERVICE_SECRET_ARN
ENV SERVICE_SECRET_ARN $SERVICE_SECRET_ARN

ARG DEPLOYMENT_ID
ENV DEPLOYMENT_ID $DEPLOYMENT_ID

ARG PIPELINE_ID
ENV PIPELINE_ID $PIPELINE_ID

ENV APP_DIR /usr/src/app

RUN mkdir -p $APP_DIR
WORKDIR $APP_DIR
COPY backend-ecs-fastapi-py/. .
RUN pip3 install -r ./requirements.txt
WORKDIR $APP_DIR/src
CMD python ./http_server.py
